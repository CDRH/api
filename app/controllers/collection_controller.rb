=begin
CDRH API

API to access all public Center for Digital Research in the Humanities resources

OpenAPI spec version: 0.1.0

Generated by: https://github.com/swagger-api/swagger-codegen.git

=end

class CollectionController < ApplicationController

  @@collections = ["aggregations", "collections", "buckets"]

  def index
    req = {
      "aggs" => {
        "collections" => {
          "terms" => {
            "field" => "_type",
            "size" => 200
          }
        }
      },
      "size" => 0
    }
    body = post_search req
    # display error and do not continue
    return true if !body

    collections = body.dig(*@@collections)
    collections = [] if !collections
    collections.map! do |coll|
      {
        "collection_name" => coll["key"],
        "description" => "TODO",
        "image_id" => "TODO",
        "uri" => "TODO",
        "shortname" => coll["key"],
        "item_count" => coll["doc_count"],
        "endpoint" => collection_path(coll["key"])
      }
    end

    render json: JSON.pretty_generate({
      "req" => {
        "query_string" => request.fullpath
      },
      "res" => {
        "code" => 200,
        "info" => {
          "collections" => collections
        }
      }
    })
  end

  def show
    # TODO finish this endpoint

    render json: JSON.pretty_generate({
      "req" => {
        "query_string" => request.fullpath
      },
      "res" => {
        "code" => 200,
        "info" => {
          "collection" => {},
          "endpoints" => [],
          "fields" => {}
        }
      }
    })
  end

end
